<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Excel Tools - Modular</title>

    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="src/styles/main.css">
    <link rel="stylesheet" href="src/styles/components.css">
</head>

<body class="bg-secondary min-h-screen font-sans text-primary flex">

    <!-- Skip to main content link for accessibility -->
    <a href="#main-content"
        class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-indigo-600 focus:text-white focus:rounded-lg focus:shadow-lg">
        Skip to main content
    </a>

    <!-- Sidebar -->
    <aside class="w-64 sidebar border-r flex flex-col flex-shrink-0 z-50" aria-label="Main Navigation">
        <div class="h-16 flex items-center px-6 border-b border-slate-100">
            <span class="font-bold text-xl text-slate-800 flex items-center gap-2">
                <i class="ph ph-squares-four text-indigo-600" aria-hidden="true"></i>
                Excel Suite
            </span>
        </div>

        <nav class="flex-1 overflow-y-auto py-6 space-y-1" role="navigation" aria-label="Tools">
            <button id="nav-tool1"
                class="sidebar-link active w-full flex items-center px-6 py-3 text-sm font-medium transition-colors"
                aria-current="page" aria-label="Navigate to Value Counter tool">
                <i class="ph ph-calculator mr-3 text-lg" aria-hidden="true"></i>
                Value Counter
            </button>
            <button id="nav-tool2"
                class="sidebar-link w-full flex items-center px-6 py-3 text-sm font-medium transition-colors"
                aria-label="Navigate to Smart Extractor tool">
                <i class="ph ph-table mr-3 text-lg" aria-hidden="true"></i>
                Smart Extractor
            </button>
            <button id="nav-tool3"
                class="sidebar-link w-full flex items-center px-6 py-3 text-sm font-medium transition-colors"
                aria-label="Navigate to Row Manager tool">
                <i class="ph ph-rows mr-3 text-lg" aria-hidden="true"></i>
                Row Manager
            </button>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col">
        <!-- Header -->
        <header class="app-header h-16 flex items-center justify-between px-6 shadow-sm">
            <div class="flex items-center gap-4">
                <!-- Mobile Menu Toggle -->
                <button id="mobileMenuToggle" class="md:hidden p-2 hover:bg-slate-100 rounded-lg transition-colors"
                    aria-label="Toggle navigation menu" aria-expanded="false">
                    <i class="ph ph-list text-2xl" aria-hidden="true"></i>
                </button>
                <div class="flex items-center gap-2">
                    <div
                        class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-sm">
                        <i class="ph-bold ph-table text-white text-lg" aria-hidden="true"></i>
                    </div>
                    <h1 class="text-lg font-semibold text-slate-800">Excel Tools Suite</h1>
                </div>
                <div class="header-status flex items-center gap-3 text-xs text-slate-500 bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-200"
                    aria-live="polite" aria-atomic="true">
                    <span class="flex items-center gap-1">
                        <i class="ph ph-file-text text-indigo-500" aria-hidden="true"></i>
                        Files: <strong class="text-slate-700" id="global-file-count">0</strong>
                    </span>
                    <span class="text-slate-300" aria-hidden="true">•</span>
                    <span class="flex items-center gap-1">
                        <i class="ph ph-calculator text-emerald-500" aria-hidden="true"></i>
                        Total: <strong class="text-slate-700" id="global-total-sum">0</strong>
                    </span>
                    <span class="text-slate-300" aria-hidden="true">•</span>
                    <span class="flex items-center gap-1">
                        <i class="ph ph-clock text-slate-400" aria-hidden="true"></i>
                        Last: <span id="last-activity">--:--</span>
                    </span>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="window.loadSampleData()"
                    class="px-3 py-1.5 text-xs font-medium text-indigo-600 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition-colors mr-2">
                    <i class="ph ph-flask mr-1"></i>
                    Sample Data
                </button>
                <button id="helpBtn" class="p-2 hover:bg-slate-100 rounded-lg transition-colors" aria-label="Help">
                    <i class="ph ph-question text-lg" aria-hidden="true"></i>
                </button>
                <button id="settingsBtn" class="p-2 hover:bg-slate-100 rounded-lg transition-colors"
                    aria-label="Settings">
                    <i class="ph ph-gear text-lg" aria-hidden="true"></i>
                </button>
                <button id="themeToggle" class="p-2 hover:bg-secondary rounded-lg transition-colors"
                    aria-label="Toggle Dark Mode">
                    <i class="ph ph-moon text-lg" aria-hidden="true"></i>
                </button>
            </div>
        </header>

        <!-- Tool Content Area -->
        <main id="main-content" class="flex-1 overflow-auto p-6" role="main" aria-label="Tool content area">
            <!-- Tool 1: Value Counter -->
            <section id="tool1-content" class="space-y-6" aria-labelledby="tool1-heading">
                <div class="flex items-center justify-between">
                    <h2 id="tool1-heading" class="text-2xl font-bold text-slate-800">Value Counter</h2>

                    <!-- Internal Tab Navigation -->
                    <nav class="internal-tabs" role="tablist" aria-label="Value Counter sections">
                        <button class="internal-tab active" role="tab" aria-selected="true"
                            aria-controls="import-section" data-tab="import">
                            <i class="ph ph-upload-simple" aria-hidden="true"></i>
                            Import
                        </button>
                        <button class="internal-tab" role="tab" aria-selected="false" aria-controls="analysis-section"
                            data-tab="analysis">
                            <i class="ph ph-chart-bar" aria-hidden="true"></i>
                            Analysis
                        </button>
                        <button class="internal-tab" role="tab" aria-selected="false" aria-controls="debug-section"
                            data-tab="debug">
                            <i class="ph ph-bug" aria-hidden="true"></i>
                            Debug
                        </button>
                    </nav>
                </div>

                <!-- Import Data Section Group -->
                <div class="section-group section-group-upload">
                    <div class="section-group-header">
                        <div class="section-group-icon">
                            <i class="ph-bold ph-upload-simple" aria-hidden="true"></i>
                        </div>
                        <div>
                            <h3 class="section-group-title">Import Data</h3>
                            <p class="section-group-description">Upload your Excel files for processing</p>
                        </div>
                    </div>

                    <!-- File Upload Areas -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6" aria-label="File upload section">
                        <!-- Protokoll Upload -->
                        <section class="section-card p-6" aria-labelledby="protokoll-heading">
                            <div class="flex items-start justify-between mb-4">
                                <div>
                                    <h3 id="protokoll-heading" class="text-lg font-semibold flex items-center gap-2">
                                        <i class="ph ph-file-text text-indigo-500" aria-hidden="true"></i>
                                        Protokoll File
                                    </h3>
                                    <p class="text-xs text-slate-500 mt-1">Upload your protocol Excel file</p>
                                </div>
                                <div id="protokollStatusBadge" class="hidden" aria-live="polite"></div>
                            </div>

                            <div id="protokollDropzone"
                                class="dropzone dropzone-protokoll border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-all duration-200"
                                role="button" tabindex="0"
                                aria-label="Upload Protokoll File. Drop file here or press Enter to browse.">
                                <i class="ph ph-upload text-4xl text-indigo-400 mb-2" aria-hidden="true"></i>
                                <p class="text-sm text-slate-600 mb-1">Drop Protokoll file here or click to browse</p>
                                <p class="text-xs text-slate-400">.xlsx or .xls files only</p>
                                <input type="file" id="protokollFileInput" accept=".xlsx,.xls" class="hidden"
                                    tabindex="-1">
                            </div>

                            <!-- Progress Bar -->
                            <div id="protokollProgress" class="mt-4 hidden" aria-live="polite"></div>

                            <!-- File Metadata -->
                            <div id="protokollMetadata"
                                class="mt-4 p-4 bg-indigo-50 border border-indigo-100 rounded-lg hidden"
                                aria-live="polite">
                            </div>

                            <!-- Remove Button -->
                            <button id="protokollRemoveBtn" class="btn btn-secondary w-full mt-3 hidden"
                                aria-label="Remove Protokoll file">
                                <i class="ph ph-x mr-2" aria-hidden="true"></i>
                                Remove File
                            </button>
                        </section>

                        <!-- Abrechnung Upload -->
                        <section class="section-card p-6" aria-labelledby="abrechnung-heading">
                            <div class="flex items-start justify-between mb-4">
                                <div>
                                    <h3 id="abrechnung-heading" class="text-lg font-semibold flex items-center gap-2">
                                        <i class="ph ph-file-text text-emerald-500" aria-hidden="true"></i>
                                        Abrechnung File
                                    </h3>
                                    <p class="text-xs text-slate-500 mt-1">Upload your billing Excel file</p>
                                </div>
                                <div id="abrechnungStatusBadge" class="hidden" aria-live="polite"></div>
                            </div>

                            <div id="abrechnungDropzone"
                                class="dropzone dropzone-abrechnung border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-all duration-200"
                                role="button" tabindex="0"
                                aria-label="Upload Abrechnung File. Drop file here or press Enter to browse.">
                                <i class="ph ph-upload text-4xl text-emerald-400 mb-2" aria-hidden="true"></i>
                                <p class="text-sm text-slate-600 mb-1">Drop Abrechnung file here or click to browse</p>
                                <p class="text-xs text-slate-400">.xlsx or .xls files only</p>
                                <input type="file" id="abrechnungFileInput" accept=".xlsx,.xls" class="hidden"
                                    tabindex="-1">
                            </div>

                            <!-- Progress Bar -->
                            <div id="abrechnungProgress" class="mt-4 hidden" aria-live="polite"></div>

                            <!-- File Metadata -->
                            <div id="abrechnungMetadata"
                                class="mt-4 p-4 bg-emerald-50 border border-emerald-100 rounded-lg hidden"
                                aria-live="polite">
                            </div>

                            <!-- Remove Button -->
                            <button id="abrechnungRemoveBtn" class="btn btn-secondary w-full mt-3 hidden"
                                aria-label="Remove Abrechnung file">
                                <i class="ph ph-x mr-2" aria-hidden="true"></i>
                                Remove File
                            </button>
                        </section>
                    </div>

                    <!-- Upload History -->
                    <section class="section-card p-6 mt-6" aria-labelledby="upload-history-heading">
                        <h3 id="upload-history-heading"
                            class="text-sm font-semibold text-slate-600 mb-3 flex items-center gap-2">
                            <i class="ph ph-clock-counter-clockwise text-slate-400" aria-hidden="true"></i>
                            Recent Uploads
                        </h3>
                        <div id="uploadHistoryList" class="space-y-2">
                            <p class="text-xs text-slate-400 italic">No recent uploads</p>
                        </div>
                    </section>

                    <!-- Target Values -->
                    <section class="section-card p-6" aria-labelledby="targets-heading">
                        <h3 id="targets-heading" class="text-lg font-semibold mb-4">Target Values</h3>
                        <label for="targetValues" class="sr-only">Target Values List</label>
                        <textarea id="targetValues" rows="4"
                            class="w-full border border-slate-300 rounded-lg p-3 text-sm"
                            placeholder="Enter target values (one per line)">Montage
Demontage
Reparatur
Wartung</textarea>
                        <div id="targetValuesError" class="input-error hidden" aria-live="polite"></div>
                        <button id="resetTargetsBtn" class="btn btn-secondary mt-2">
                            <i class="ph ph-arrow-counter-clockwise mr-2" aria-hidden="true"></i>
                            Reset to Defaults
                        </button>
                    </section>
                </div>
                <!-- End Import Data Section Group -->

                <!-- Reconciliation Section Group -->
                <div id="reconciliationSection" class="section-group section-group-reconciliation hidden"
                    aria-labelledby="reconciliation-heading">
                    <div class="section-group-header">
                        <div class="section-group-icon bg-gradient-to-br from-purple-500 to-purple-600">
                            <i class="ph-bold ph-scales text-white" aria-hidden="true"></i>
                        </div>
                        <div>
                            <h3 id="reconciliation-heading" class="section-group-title">Reconciliation View</h3>
                            <p class="section-group-description">Compare Protokoll and Abrechnung files</p>
                        </div>
                    </div>

                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="section-card p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs font-medium text-slate-500 uppercase">Matches</span>
                                <i class="ph ph-check-circle text-emerald-500 text-xl" aria-hidden="true"></i>
                            </div>
                            <div class="text-2xl font-bold text-slate-800" id="reconciliationMatches">0</div>
                            <div class="text-xs text-slate-500 mt-1" id="reconciliationMatchPercent">0% match rate</div>
                        </div>

                        <div class="section-card p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs font-medium text-slate-500 uppercase">Discrepancies</span>
                                <i class="ph ph-warning text-amber-500 text-xl" aria-hidden="true"></i>
                            </div>
                            <div class="text-2xl font-bold text-slate-800" id="reconciliationDiscrepancies">0</div>
                            <div class="text-xs text-slate-500 mt-1">Requires attention</div>
                        </div>

                        <div class="section-card p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs font-medium text-slate-500 uppercase">Missing</span>
                                <i class="ph ph-x-circle text-red-500 text-xl" aria-hidden="true"></i>
                            </div>
                            <div class="text-2xl font-bold text-slate-800" id="reconciliationMissing">0</div>
                            <div class="text-xs text-slate-500 mt-1">Orders not found</div>
                        </div>

                        <div class="section-card p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs font-medium text-slate-500 uppercase">Total Orders</span>
                                <i class="ph ph-list-numbers text-indigo-500 text-xl" aria-hidden="true"></i>
                            </div>
                            <div class="text-2xl font-bold text-slate-800" id="reconciliationTotal">0</div>
                            <div class="text-xs text-slate-500 mt-1">Combined</div>
                        </div>
                    </div>

                    <!-- Reconciliation Tabs -->
                    <div class="section-card">
                        <nav class="internal-tabs border-b" role="tablist" aria-label="Reconciliation tabs">
                            <button class="internal-tab active" role="tab" aria-selected="true"
                                aria-controls="reconciliation-all-section" data-reconciliation-tab="all">
                                <i class="ph ph-list" aria-hidden="true"></i>
                                All Results
                            </button>
                            <button class="internal-tab" role="tab" aria-selected="false"
                                aria-controls="reconciliation-matches-section" data-reconciliation-tab="matches">
                                <i class="ph ph-check-circle" aria-hidden="true"></i>
                                Matches
                            </button>
                            <button class="internal-tab" role="tab" aria-selected="false"
                                aria-controls="reconciliation-discrepancies-section"
                                data-reconciliation-tab="discrepancies">
                                <i class="ph ph-warning" aria-hidden="true"></i>
                                Discrepancies
                            </button>
                        </nav>

                        <!-- Reconciliation Table -->
                        <div class="p-6">
                            <div class="mb-4 flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <input type="text" id="reconciliationSearch"
                                        class="px-3 py-2 text-sm border border-slate-300 rounded-lg"
                                        placeholder="Search order numbers..."
                                        aria-label="Search reconciliation results">
                                    <button id="reconciliationRefreshBtn" class="btn btn-secondary text-sm"
                                        aria-label="Refresh reconciliation">
                                        <i class="ph ph-arrows-clockwise" aria-hidden="true"></i>
                                    </button>
                                </div>
                                <button id="reconciliationExportBtn" class="btn btn-primary text-sm"
                                    aria-label="Export reconciliation results">
                                    <i class="ph ph-download-simple mr-2" aria-hidden="true"></i>
                                    Export CSV
                                </button>
                            </div>

                            <div class="overflow-x-auto">
                                <table class="w-full" id="reconciliationTable">
                                    <thead>
                                        <tr class="border-b border-slate-200">
                                            <th
                                                class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase">
                                                <i class="ph ph-hash mr-1" aria-hidden="true"></i>
                                                Order Number
                                            </th>
                                            <th
                                                class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase">
                                                Status
                                            </th>
                                            <th
                                                class="px-4 py-3 text-right text-xs font-semibold text-slate-600 uppercase">
                                                Protokoll Amount
                                            </th>
                                            <th
                                                class="px-4 py-3 text-right text-xs font-semibold text-slate-600 uppercase">
                                                Abrechnung Amount
                                            </th>
                                            <th
                                                class="px-4 py-3 text-right text-xs font-semibold text-slate-600 uppercase">
                                                Difference
                                            </th>
                                            <th
                                                class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase">
                                                Message
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="reconciliationTableBody">
                                        <tr>
                                            <td colspan="6" class="px-4 py-8 text-center text-slate-400">
                                                <i class="ph ph-scales text-4xl mb-2 block" aria-hidden="true"></i>
                                                Upload both Protokoll and Abrechnung files to see reconciliation results
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Reconciliation Section Group -->

                <!-- Extracted Data Section Group -->
                <div class="section-group section-group-data">
                    <div class="section-group-header">
                        <div class="section-group-icon">
                            <i class="ph-bold ph-table" aria-hidden="true"></i>
                        </div>
                        <div>
                            <h3 class="section-group-title">Extracted Data</h3>
                            <p class="section-group-description">View and analyze processed data</p>
                        </div>
                    </div>

                    <!-- Extracted Header -->
                    <section class="section-card" aria-labelledby="extracted-heading">
                        <div class="section-header">
                            <h3 id="extracted-heading" class="text-lg font-semibold flex items-center gap-2">
                                <i class="ph ph-info text-indigo-500" aria-hidden="true"></i>
                                Extracted Header Information
                            </h3>
                            <button id="extractedDetailsToggle" class="collapse-btn"
                                aria-label="Toggle Extracted Information" aria-expanded="true"
                                aria-controls="extractedDetailsContent">
                                <i id="extractedDetailsIcon" class="ph ph-caret-down collapse-icon rotated"
                                    aria-hidden="true"></i>
                            </button>
                        </div>
                        <div id="extractedDetailsContent" class="collapsible-content expanded p-6" role="region"
                            aria-live="polite">
                            <div id="extractedHeaderInfo" class="text-sm text-slate-500">
                                Upload Protokoll file to see extracted information
                            </div>
                        </div>
                    </section>

                    <!-- Results Header & Summary -->
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-4">
                            <h3 class="text-lg font-semibold flex items-center gap-2">
                                <i class="ph ph-chart-bar text-indigo-600" aria-hidden="true"></i>
                                Results
                            </h3>
                            <div class="relative w-64">
                                <i
                                    class="ph ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" id="tool1-search-input"
                                    class="w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"
                                    placeholder="Search results..." aria-label="Filter results table">
                            </div>
                            <button id="tool1ExportCsvBtn" class="btn btn-secondary text-sm"
                                aria-label="Export Results to CSV">
                                <i class="ph ph-download-simple mr-2" aria-hidden="true"></i>
                                Export CSV
                            </button>
                        </div>

                        <!-- Loading Indicator (Hidden by default) -->
                        <div id="processingIndicator"
                            class="hidden flex items-center gap-2 text-sm text-indigo-600 font-medium">
                            <i class="ph ph-spinner animate-spin text-lg" aria-hidden="true"></i>
                            Processing...
                        </div>
                    </div>

                    <!-- Dashboard Metrics Section -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <!-- Total Amount Card with Sparkline -->
                        <div
                            class="stat-card bg-white border border-slate-200 rounded-xl p-4 shadow-sm relative overflow-hidden group hover:border-indigo-300 transition-all duration-300">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">Total
                                        Amount</p>
                                    <h4 id="dashboardTotalAmount" class="text-2xl font-bold text-slate-800 mt-1">€0,00
                                    </h4>
                                </div>
                                <div
                                    class="w-8 h-8 rounded-lg bg-indigo-50 flex items-center justify-center text-indigo-600">
                                    <i class="ph-bold ph-currency-eur text-lg"></i>
                                </div>
                            </div>
                            <div class="flex items-end justify-between mt-2">
                                <div
                                    class="text-xs text-emerald-600 bg-emerald-50 px-2 py-0.5 rounded-full flex items-center gap-1">
                                    <i class="ph-bold ph-trend-up"></i>
                                    <span id="trendLabel">Total</span>
                                </div>
                                <!-- Sparkline SVG Container -->
                                <svg id="sparklineTotal" class="sparkline w-24 h-8 text-indigo-200" viewBox="0 0 100 30"
                                    preserveAspectRatio="none">
                                    <!-- Path injected by JS -->
                                </svg>
                            </div>
                        </div>

                        <!-- Average Amount Card -->
                        <div
                            class="stat-card bg-white border border-slate-200 rounded-xl p-4 shadow-sm hover:border-indigo-300 transition-all duration-300">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">Avg Amount
                                    </p>
                                    <h4 id="dashboardAvgAmount" class="text-2xl font-bold text-slate-800 mt-1">€0,00
                                    </h4>
                                </div>
                                <div
                                    class="w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center text-blue-600">
                                    <i class="ph-bold ph-chart-line text-lg"></i>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="h-1.5 w-full bg-slate-100 rounded-full overflow-hidden">
                                    <div class="h-full bg-blue-500 rounded-full" style="width: 0%"></div>
                                </div>
                                <p class="text-xs text-slate-400 mt-1">Per transaction</p>
                            </div>
                        </div>

                        <!-- Transaction Count Card -->
                        <div
                            class="stat-card bg-white border border-slate-200 rounded-xl p-4 shadow-sm hover:border-emerald-300 transition-all duration-300">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">
                                        Transactions</p>
                                    <h4 id="dashboardTxCount" class="text-2xl font-bold text-slate-800 mt-1">0</h4>
                                </div>
                                <div
                                    class="w-8 h-8 rounded-lg bg-emerald-50 flex items-center justify-center text-emerald-600">
                                    <i class="ph-bold ph-receipt text-lg"></i>
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-2 mt-3">
                                <div
                                    class="text-xs text-slate-500 bg-slate-50 px-2 py-1 rounded border border-slate-100">
                                    <i class="ph-bold ph-target text-indigo-400 mr-1"></i>
                                    <strong id="dashboardUniqueTargets">0</strong> Unique
                                </div>
                            </div>
                        </div>

                        <!-- Date Range Card -->
                        <div
                            class="stat-card bg-white border border-slate-200 rounded-xl p-4 shadow-sm hover:border-amber-300 transition-all duration-300">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <p class="text-xs font-semibold text-slate-500 uppercase tracking-wider">Time Period
                                    </p>
                                    <h4 id="dashboardDateRange"
                                        class="text-sm font-semibold text-slate-800 mt-1 leading-tight">No dates</h4>
                                </div>
                                <div
                                    class="w-8 h-8 rounded-lg bg-amber-50 flex items-center justify-center text-amber-600">
                                    <i class="ph-bold ph-calendar text-lg"></i>
                                </div>
                            </div>
                            <p class="text-xs text-slate-400 mt-2">Based on processed files</p>
                        </div>
                    </div>

                    <!-- Data Summary Panel -->
                    <div class="bg-white border border-slate-200 rounded-xl shadow-sm mb-6 overflow-hidden">
                        <div
                            class="px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-slate-50/50">
                            <h3 class="font-semibold text-slate-700 flex items-center gap-2">
                                <i class="ph-bold ph-database text-indigo-500"></i>
                                Data Health & Summary
                            </h3>
                            <div class="flex items-center gap-2">
                                <span class="text-xs font-medium text-slate-500">Overall Quality</span>
                                <div class="w-24 h-2 bg-slate-200 rounded-full overflow-hidden">
                                    <div id="dataHealthBar" class="h-full bg-emerald-500 transition-all duration-500"
                                        style="width: 0%"></div>
                                </div>
                                <span id="dataHealthScore" class="text-xs font-bold text-slate-700">0%</span>
                            </div>
                        </div>
                        <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- File Breakdown -->
                            <div>
                                <h4 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-4">File
                                    Statistics</h4>
                                <div class="space-y-3">
                                    <div
                                        class="flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100">
                                        <div class="flex items-center gap-3">
                                            <div class="w-2 h-2 rounded-full bg-indigo-500"></div>
                                            <span class="text-sm font-medium text-slate-700">Protokoll</span>
                                        </div>
                                        <div class="text-right">
                                            <span class="block text-sm font-bold text-slate-800"
                                                id="summaryProtokollRows">0 rows</span>
                                        </div>
                                    </div>
                                    <div
                                        class="flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100">
                                        <div class="flex items-center gap-3">
                                            <div class="w-2 h-2 rounded-full bg-emerald-500"></div>
                                            <span class="text-sm font-medium text-slate-700">Abrechnung</span>
                                        </div>
                                        <div class="text-right">
                                            <span class="block text-sm font-bold text-slate-800"
                                                id="summaryAbrechnungRows">0 rows</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Data Issues -->
                            <div>
                                <h4 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-4">Data
                                    Integrity</h4>
                                <ul id="dataIssuesList" class="space-y-2">
                                    <li class="flex items-start gap-2 text-sm text-slate-500">
                                        <i class="ph-fill ph-check-circle text-emerald-500 mt-0.5"></i>
                                        Waiting for data...
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    </header>
                    <div class="table-container overflow-x-auto" role="region" aria-labelledby="results-title">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th class="w-16">#</th>
                                    <th class="sortable" data-sort="target" aria-sort="none">
                                        Target Value
                                        <i class="ph ph-caret-up-down sort-icon"></i>
                                    </th>
                                    <th class="text-right sortable" data-sort="count" aria-sort="none">
                                        Count
                                        <i class="ph ph-caret-up-down sort-icon"></i>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                    </article>
                </div>
                <!-- End Extracted Data Section Group -->

                <!-- Debug Info Section -->
                <section class="section-card" aria-labelledby="debug-heading">
                    <div class="section-header">
                        <h3 id="debug-heading" class="text-lg font-semibold flex items-center gap-2">
                            <i class="ph ph-bug text-slate-500" aria-hidden="true"></i>
                            Debug Information
                        </h3>
                        <div class="flex items-center gap-2">
                            <button id="copyDebugBtn" class="btn-icon-sm" title="Copy debug info"
                                aria-label="Copy debug information to clipboard">
                                <i class="ph ph-copy"></i>
                            </button>
                            <button id="tool1ExportJsonBtn" class="btn-icon-sm" title="Export debug data as JSON"
                                aria-label="Export debug data to JSON">
                                <i class="ph ph-brackets-curly"></i>
                            </button>
                            <button id="debugToggle" class="collapse-btn" aria-label="Toggle Debug Information"
                                aria-expanded="false" aria-controls="debugContent">
                                <i id="debugCollapseIcon" class="ph ph-caret-down collapse-icon" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                    <div id="debugContent" class="collapsible-content p-6 hidden" role="region">
                        <pre id="debugInfo"
                            class="debug-output text-xs bg-slate-900 text-slate-100 p-4 rounded-lg overflow-x-auto">No debug information available</pre>
                    </div>
                </section>
            </section>

            <!-- Tool 2: Smart Extractor -->
            <section id="tool2-content" class="tool-section hidden space-y-6">
                <header class="section-header-inline mb-6 flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">Smart Extractor</h2>
                        <p class="text-sm text-slate-500 mt-1">Extract and process data from Excel files</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <span id="record-count-badge"
                            class="hidden bg-indigo-100 text-indigo-700 py-1 px-3 rounded-full text-xs font-semibold">0
                            Records</span>
                        <div class="text-right">
                            <p class="text-xs text-slate-500 uppercase tracking-wide">Total Amount</p>
                            <p id="total-display" class="text-xl font-bold text-slate-800">0,00 €</p>
                        </div>
                    </div>
                </header>

                <!-- File Upload Section -->
                <div class="section-card p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">Upload Excel Files</h3>
                        <button id="btnClearUpload" onclick="clearExtractorUpload()"
                            class="btn btn-secondary text-xs hidden">
                            <i class="ph ph-x text-sm"></i>
                            Clear Files
                        </button>
                        <button id="btnPasteClipboard" class="btn btn-secondary text-xs ml-2">
                            <i class="ph ph-clipboard-text text-sm"></i>
                            Paste from Clipboard
                        </button>
                    </div>

                    <!-- Drop Area -->
                    <div id="drop-area"
                        class="border-2 border-dashed border-slate-300 rounded-lg p-8 text-center cursor-pointer hover:border-indigo-400 hover:bg-indigo-50/50 transition-all"
                        role="button" tabindex="0"
                        aria-label="Upload Excel files. Drop files here or press Enter to browse.">
                        <i class="ph ph-upload text-4xl text-indigo-400 mb-2" aria-hidden="true"></i>
                        <p class="text-sm text-slate-600 font-medium mb-1">Drop Excel files here or click to browse</p>
                        <p class="text-xs text-slate-400">Supports .xlsx and .xls files</p>
                        <input type="file" id="fileElem" accept=".xlsx,.xls" multiple class="hidden" tabindex="-1">
                    </div>

                    <!-- File Metadata Display -->
                    <div id="extractorMetadata" class="mt-4 p-4 bg-slate-50 rounded-lg border border-slate-200 hidden">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="text-sm font-semibold text-slate-700 flex items-center gap-2">
                                <i class="ph ph-files text-indigo-600" aria-hidden="true"></i>
                                Uploaded Files
                            </h4>
                            <span id="fileCountBadge"
                                class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full font-medium">0
                                files</span>
                        </div>
                        <div id="extractorFileList" class="space-y-2">
                            <!-- File items will be added here dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Controls Bar -->
                <div
                    class="flex flex-wrap items-center justify-between gap-4 p-4 bg-primary rounded-xl border border-default shadow-sm">
                    <div class="flex items-center gap-3 flex-1 min-w-[300px]">
                        <div class="relative flex-1">
                            <i
                                class="ph ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                            <input type="text" id="filter-input-extractor"
                                class="w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"
                                placeholder="Search by Order No, Location, Name...">
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="btnCopyTable2" disabled
                            class="btn btn-secondary disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="ph ph-copy text-lg"></i>
                            <span class="hidden sm:inline">Copy Table</span>
                        </button>
                        <button id="btn-export" disabled
                            class="btn btn-secondary disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="ph ph-download-simple text-lg"></i>
                            Export XLSX
                        </button>
                        <button id="btn-export-csv" disabled
                            class="btn btn-secondary disabled:opacity-50 disabled:cursor-not-allowed hidden sm:flex">
                            <i class="ph ph-file-csv text-lg"></i>
                            CSV
                        </button>
                        <button id="btn-export-json" disabled
                            class="btn btn-secondary disabled:opacity-50 disabled:cursor-not-allowed hidden sm:flex">
                            <i class="ph ph-brackets-curly text-lg"></i>
                            JSON
                        </button>
                        <button id="btnClear" class="btn btn-danger" aria-label="Clear All Data">
                            <i class="ph ph-trash text-lg"></i>
                        </button>
                    </div>
                </div>

                <!-- Main Data Table -->
                <div
                    class="bg-primary rounded-xl border border-default shadow-sm overflow-hidden flex flex-col h-[600px]">
                    <div class="overflow-auto custom-scrollbar flex-1">
                        <table class="w-full text-left border-collapse">
                            <thead class="sticky top-0 z-10 shadow-sm">
                                <tr>
                                    <th
                                        class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider whitespace-nowrap">
                                        File</th>
                                    <th class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider cursor-pointer hover:bg-slate-100 transition-colors group select-none whitespace-nowrap"
                                        id="header-auftrag" aria-sort="none">
                                        <div class="flex items-center gap-1">
                                            Auftrag Nr.
                                            <i data-lucide="chevrons-up-down"
                                                class="w-3 h-3 text-slate-400 opacity-0 group-hover:opacity-50 transition-opacity sort-icon"
                                                id="sort-auftragsNr"></i>
                                        </div>
                                    </th>
                                    <th class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider cursor-pointer hover:bg-slate-100 transition-colors group select-none whitespace-nowrap"
                                        id="header-anlage" aria-sort="none">
                                        <div class="flex items-center gap-1">
                                            Anlage
                                            <i data-lucide="chevrons-up-down"
                                                class="w-3 h-3 text-slate-400 opacity-0 group-hover:opacity-50 transition-opacity sort-icon"
                                                id="sort-anlage"></i>
                                        </div>
                                    </th>
                                    <th
                                        class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider whitespace-nowrap">
                                        Einsatzort</th>
                                    <th class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider cursor-pointer hover:bg-slate-100 transition-colors group select-none whitespace-nowrap"
                                        id="header-datum" aria-sort="none">
                                        <div class="flex items-center gap-1">
                                            Datum
                                            <i data-lucide="chevrons-up-down"
                                                class="w-3 h-3 text-slate-400 opacity-0 group-hover:opacity-50 transition-opacity sort-icon"
                                                id="sort-datum"></i>
                                        </div>
                                    </th>
                                    <th
                                        class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider text-right whitespace-nowrap">
                                        Std.</th>
                                    <th class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider text-right cursor-pointer hover:bg-slate-100 transition-colors group select-none whitespace-nowrap"
                                        id="header-summe">
                                        <div class="flex items-center justify-end gap-1">
                                            Summe
                                            <i data-lucide="chevrons-up-down"
                                                class="w-3 h-3 text-slate-400 opacity-0 group-hover:opacity-50 transition-opacity sort-icon"
                                                id="sort-sumRaw"></i>
                                        </div>
                                    </th>
                                    <th
                                        class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider whitespace-nowrap">
                                        Bemerkung</th>
                                </tr>
                            </thead>
                            <tbody id="table-body" class="divide-y divide-slate-100">
                                <!-- Empty State -->
                                <tr id="empty-state" class="group">
                                    <td colspan="8" class="p-0 border-0">
                                        <div class="empty-state">
                                            <i class="ph ph-file-dashed empty-state-icon" aria-hidden="true"></i>
                                            <h3 class="empty-state-text">No Data Extracted Yet</h3>
                                            <p class="empty-state-subtext">Upload Excel files with "Protokoll" or
                                                "Abrechnung" in the filename to automatically extract and display data.
                                                Supported columns: Auftrag-Nr., Anlage, Einsatzort, Datum, Summe,
                                                Bemerkung.</p>
                                            <div class="empty-state-hint">
                                                <i class="ph ph-info" aria-hidden="true"></i>
                                                <span>Tip: Files are processed automatically upon upload</span>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Footer Info -->
                    <div
                        class="bg-slate-50 px-6 py-3 border-t border-slate-200 text-xs text-slate-500 flex justify-between items-center">
                        <span>Showing <strong id="count-display" class="text-slate-700">0</strong> records</span>
                        <div class="flex gap-4">
                            <span class="flex items-center gap-1"><span
                                    class="w-2 h-2 rounded-full bg-orange-100 border border-orange-200"></span> Has
                                Remarks</span>
                            <span class="flex items-center gap-1"><span
                                    class="w-2 h-2 rounded-full bg-white border border-slate-200"></span>
                                Standard</span>
                        </div>
                    </div>
                </div>

                <!-- Debug Information Section -->
                <section class="section-card" aria-labelledby="tool2-debug-heading">
                    <div class="section-header">
                        <h3 id="tool2-debug-heading" class="text-lg font-semibold flex items-center gap-2">
                            <i class="ph ph-bug text-slate-500" aria-hidden="true"></i>
                            Debugging Information
                        </h3>
                        <div class="flex items-center gap-2">
                            <button id="copyTool2DebugBtn" class="btn-icon-sm" title="Copy debug info"
                                aria-label="Copy debugging information to clipboard">
                                <i class="ph ph-copy"></i>
                            </button>
                            <button id="tool2DebugToggle" class="collapse-btn" aria-label="Toggle Debug Information"
                                aria-expanded="false" aria-controls="tool2DebugContent">
                                <i id="tool2DebugCollapseIcon" class="ph ph-caret-down collapse-icon"
                                    aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                    <div id="tool2DebugContent" class="collapsible-content p-6 hidden" role="region">
                        <pre id="tool2DebugInfo"
                            class="debug-output text-xs bg-slate-900 text-slate-100 p-4 rounded-lg overflow-x-auto font-mono">No debugging information available. Upload files to see extraction details.</pre>
                    </div>
                </section>
            </section>

            <!-- Tool 3: Row Manager -->
            <section id="tool3-content" class="tool-section hidden space-y-6">
                <header class="section-header-inline mb-6 flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">Row Manager</h2>
                        <p class="text-sm text-slate-500 mt-1">Manage and organize rows in Excel files</p>
                    </div>
                </header>

                <!-- Controls Bar -->
                <div
                    class="flex flex-wrap items-center justify-between gap-4 p-4 bg-primary rounded-xl border border-default shadow-sm">
                    <div class="flex items-center gap-2">
                        <button id="btnCopyTable3" disabled
                            class="btn btn-secondary disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="ph ph-copy text-lg"></i>
                            Copy Selected Rows
                        </button>
                        <button id="btn-rm-export-excel" disabled
                            class="btn btn-secondary disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="ph ph-download-simple text-lg"></i>
                            Export XLSX
                        </button>
                        <button id="btn-rm-save" disabled
                            class="btn btn-primary disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="ph ph-floppy-disk text-lg"></i>
                            Save Changes
                        </button>
                    </div>
                    <div class="flex items-center gap-3">
                        <span id="rm-status"
                            class="text-sm font-medium text-slate-600 bg-slate-100 px-3 py-1.5 rounded-lg border border-slate-200">
                            0 Rows
                        </span>
                    </div>
                </div>

                <!-- Main Row Table -->
                <div
                    class="bg-primary rounded-xl border border-default shadow-sm overflow-hidden flex flex-col h-[600px]">
                    <div class="overflow-auto custom-scrollbar flex-1 relative">
                        <table class="w-full text-left border-collapse">
                            <thead class="sticky top-0 z-10 shadow-sm" id="rm-thead">
                                <tr id="rm-thead-tr">
                                    <!-- Headers injected by JS -->
                                    <th class="px-6 py-4 text-center text-slate-400 italic font-normal">Upload a file to
                                        see columns</th>
                                </tr>
                            </thead>
                            <tbody id="rm-tbody" class="divide-y divide-slate-100">
                                <!-- Rows injected by JS -->
                                <tr class="group">
                                    <td colspan="10" class="px-6 py-12 text-center text-slate-400 bg-white">
                                        <div class="flex flex-col items-center justify-center gap-3">
                                            <div
                                                class="w-16 h-16 rounded-full bg-slate-50 flex items-center justify-center mb-2 group-hover:scale-110 transition-transform duration-300">
                                                <i class="ph ph-rows text-3xl text-slate-300"></i>
                                            </div>
                                            <p class="text-base font-medium text-slate-600">No rows data</p>
                                            <p class="text-sm text-slate-400 max-w-md mx-auto">Upload an Excel file to
                                                view and manage individual rows.</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals (Settings, Help) -->
    <div id="settingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center">
        <div class="bg-white rounded-lg p-6 max-w-md w-full">
            <h2 class="text-xl font-bold mb-4">Settings</h2>
            <p class="text-slate-600 mb-4">Settings panel content</p>
            <button id="closeSettingsModal" class="btn btn-primary">Close</button>
        </div>
    </div>

    <div id="helpPanel" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center">
        <div class="bg-white rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-auto">
            <h2 class="text-xl font-bold mb-4">Help & Documentation</h2>
            <p class="text-slate-600 mb-4">Help content will be displayed here</p>
            <button id="closeHelpPanel" class="btn btn-primary">Close</button>
        </div>
    </div>

    <!-- Main Application Script -->
    <script src="src/scripts/theme.js"></script>
    <script type="module" src="src/main.js"></script>
</body>

</html>