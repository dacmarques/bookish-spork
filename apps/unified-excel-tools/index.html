<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Excel Tools - Modular</title>

    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="src/styles/main.css">
    <link rel="stylesheet" href="src/styles/components.css">
</head>

<body class="bg-slate-50 min-h-screen font-sans text-slate-800 flex overflow-hidden">

    <!-- Sidebar -->
    <aside class="w-64 bg-white border-r border-slate-200 flex flex-col flex-shrink-0 z-50"
        aria-label="Main Navigation">
        <div class="h-16 flex items-center px-6 border-b border-slate-100">
            <span class="font-bold text-xl text-slate-800 flex items-center gap-2">
                <i class="ph ph-squares-four text-indigo-600" aria-hidden="true"></i>
                Excel Suite
            </span>
        </div>

        <nav class="flex-1 overflow-y-auto py-6 space-y-1" aria-label="Tools">
            <button id="nav-tool1"
                class="sidebar-link active w-full flex items-center px-6 py-3 text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors"
                aria-current="page">
                <i class="ph ph-calculator mr-3 text-lg" aria-hidden="true"></i>
                Value Counter
            </button>
            <button id="nav-tool2"
                class="sidebar-link w-full flex items-center px-6 py-3 text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors">
                <i class="ph ph-table mr-3 text-lg" aria-hidden="true"></i>
                Smart Extractor
            </button>
            <button id="nav-tool3"
                class="sidebar-link w-full flex items-center px-6 py-3 text-sm font-medium text-slate-600 hover:bg-slate-50 transition-colors">
                <i class="ph ph-rows mr-3 text-lg" aria-hidden="true"></i>
                Row Manager
            </button>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Header -->
        <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 shadow-sm">
            <div class="flex items-center gap-4">
                <h1 class="text-lg font-semibold text-slate-800">Excel Tools Suite</h1>
                <div class="header-status flex items-center gap-3 text-xs text-slate-500 bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-200"
                    aria-live="polite" aria-atomic="true">
                    <span class="flex items-center gap-1">
                        <i class="ph ph-file-text text-indigo-500" aria-hidden="true"></i>
                        Files: <strong class="text-slate-700" id="global-file-count">0</strong>
                    </span>
                    <span class="text-slate-300" aria-hidden="true">•</span>
                    <span class="flex items-center gap-1">
                        <i class="ph ph-clock text-slate-400" aria-hidden="true"></i>
                        Last activity: <span id="last-activity">--:--</span>
                    </span>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="window.loadSampleData()"
                    class="px-3 py-1.5 text-xs font-medium text-indigo-600 bg-indigo-50 hover:bg-indigo-100 rounded-lg transition-colors mr-2">
                    <i class="ph ph-flask mr-1"></i>
                    Sample Data
                </button>
                <button id="helpBtn" class="p-2 hover:bg-slate-100 rounded-lg transition-colors" aria-label="Help">
                    <i class="ph ph-question text-lg" aria-hidden="true"></i>
                </button>
                <button id="settingsBtn" class="p-2 hover:bg-slate-100 rounded-lg transition-colors"
                    aria-label="Settings">
                    <i class="ph ph-gear text-lg" aria-hidden="true"></i>
                </button>
                <button id="themeToggle" class="p-2 hover:bg-slate-100 rounded-lg transition-colors"
                    aria-label="Toggle Dark Mode">
                    <i class="ph ph-moon text-lg" aria-hidden="true"></i>
                </button>
            </div>
        </header>

        <!-- Tool Content Area -->
        <main class="flex-1 overflow-auto p-6" role="main" aria-label="Tool content area">
            <!-- Tool 1: Value Counter -->
            <section id="tool1-content" class="space-y-6" aria-labelledby="tool1-heading">
                <h2 id="tool1-heading" class="text-2xl font-bold text-slate-800">Value Counter</h2>

                <!-- File Upload Areas -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6" aria-label="File upload section">
                    <!-- Protokoll Upload -->
                    <section class="section-card p-6" aria-labelledby="protokoll-heading">
                        <h3 id="protokoll-heading" class="text-lg font-semibold mb-4">Protokoll File</h3>
                        <div id="protokollDropzone"
                            class="dropzone dropzone-protokoll border-2 border-dashed rounded-lg p-8 text-center cursor-pointer"
                            role="button" tabindex="0"
                            aria-label="Upload Protokoll File. Drop file here or press Enter to browse.">
                            <i class="ph ph-upload text-4xl text-indigo-400 mb-2" aria-hidden="true"></i>
                            <p class="text-sm text-slate-600">Drop Protokoll file here or click to browse</p>
                            <input type="file" id="protokollFileInput" accept=".xlsx,.xls" class="hidden" tabindex="-1">
                        </div>
                        <div id="protokollMetadata" class="mt-4 p-3 bg-slate-50 rounded-lg hidden" aria-live="polite">
                        </div>
                    </section>

                    <!-- Abrechnung Upload -->
                    <section class="section-card p-6" aria-labelledby="abrechnung-heading">
                        <h3 id="abrechnung-heading" class="text-lg font-semibold mb-4">Abrechnung File</h3>
                        <div id="abrechnungDropzone"
                            class="dropzone dropzone-abrechnung border-2 border-dashed rounded-lg p-8 text-center cursor-pointer"
                            role="button" tabindex="0"
                            aria-label="Upload Abrechnung File. Drop file here or press Enter to browse.">
                            <i class="ph ph-upload text-4xl text-emerald-400 mb-2" aria-hidden="true"></i>
                            <p class="text-sm text-slate-600">Drop Abrechnung file here or click to browse</p>
                            <input type="file" id="abrechnungFileInput" accept=".xlsx,.xls" class="hidden"
                                tabindex="-1">
                        </div>
                        <div id="abrechnungMetadata" class="mt-4 p-3 bg-slate-50 rounded-lg hidden" aria-live="polite">
                        </div>
                    </section>
                </div>

                <!-- Target Values -->
                <section class="section-card p-6" aria-labelledby="targets-heading">
                    <h3 id="targets-heading" class="text-lg font-semibold mb-4">Target Values</h3>
                    <label for="targetValues" class="sr-only">Target Values List</label>
                    <textarea id="targetValues" rows="4" class="w-full border border-slate-300 rounded-lg p-3 text-sm"
                        placeholder="Enter target values (one per line)">Montage
Demontage
Reparatur
Wartung</textarea>
                    <button id="resetTargetsBtn" class="btn btn-secondary mt-2">
                        <i class="ph ph-arrow-counter-clockwise mr-2" aria-hidden="true"></i>
                        Reset to Defaults
                    </button>
                </section>

                <!-- Extracted Header -->
                <section class="section-card" aria-labelledby="extracted-heading">
                    <div class="section-header">
                        <h3 id="extracted-heading" class="text-lg font-semibold flex items-center gap-2">
                            <i class="ph ph-info text-indigo-500" aria-hidden="true"></i>
                            Extracted Header Information
                        </h3>
                        <button id="extractedDetailsToggle" class="collapse-btn"
                            aria-label="Toggle Extracted Information" aria-expanded="true"
                            aria-controls="extractedDetailsContent">
                            <i id="extractedDetailsIcon" class="ph ph-caret-down collapse-icon rotated"
                                aria-hidden="true"></i>
                        </button>
                    </div>
                    <div id="extractedDetailsContent" class="collapsible-content expanded p-6" role="region"
                        aria-live="polite">
                        <div id="extractedHeaderInfo" class="text-sm text-slate-500">
                            Upload Protokoll file to see extracted information
                        </div>
                    </div>
                </section>

                <!-- Results Header & Summary -->
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold flex items-center gap-2">
                        <i class="ph ph-chart-bar text-indigo-600" aria-hidden="true"></i>
                        Results
                    </h3>

                    <!-- Loading Indicator (Hidden by default) -->
                    <div id="processingIndicator"
                        class="hidden flex items-center gap-2 text-sm text-indigo-600 font-medium">
                        <i class="ph ph-spinner animate-spin text-lg" aria-hidden="true"></i>
                        Processing...
                    </div>
                </div>

                <!-- Summary Cards Grid -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <!-- Total Matches Card -->
                    <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-4 flex items-center gap-4">
                        <div
                            class="w-10 h-10 rounded-lg bg-indigo-100 flex items-center justify-center text-indigo-600 text-xl">
                            <i class="ph ph-check-circle" aria-hidden="true"></i>
                        </div>
                        <div>
                            <p class="text-xs font-medium text-indigo-600 uppercase tracking-wide">Total Matches</p>
                            <p id="summaryTotalMatches" class="text-2xl font-bold text-indigo-700">0</p>
                        </div>
                    </div>

                    <!-- Total Rows Card -->
                    <div class="bg-white border border-slate-200 rounded-xl p-4 flex items-center gap-4">
                        <div
                            class="w-10 h-10 rounded-lg bg-slate-100 flex items-center justify-center text-slate-500 text-xl">
                            <i class="ph ph-rows" aria-hidden="true"></i>
                        </div>
                        <div>
                            <p class="text-xs font-medium text-slate-500 uppercase tracking-wide">Total Rows</p>
                            <p id="summaryTotalRows" class="text-2xl font-bold text-slate-700">0</p>
                        </div>
                    </div>

                    <!-- Unique Targets Card -->
                    <div class="bg-white border border-slate-200 rounded-xl p-4 flex items-center gap-4">
                        <div
                            class="w-10 h-10 rounded-lg bg-slate-100 flex items-center justify-center text-slate-500 text-xl">
                            <i class="ph ph-target" aria-hidden="true"></i>
                        </div>
                        <div>
                            <p class="text-xs font-medium text-slate-500 uppercase tracking-wide">Unique Targets</p>
                            <p id="summaryUniqueTargets" class="text-2xl font-bold text-slate-700">0</p>
                        </div>
                    </div>
                </div>
                </header>
                <div class="table-container overflow-x-auto" role="region" aria-labelledby="results-title">
                    <table class="w-full">
                        <thead>
                            <tr>
                                <th class="w-16">#</th>
                                <th class="sortable" data-sort="target">
                                    Target Value
                                    <i class="ph ph-caret-up-down sort-icon"></i>
                                </th>
                                <th class="text-right sortable" data-sort="count">
                                    Count
                                    <i class="ph ph-caret-up-down sort-icon"></i>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>
                </article>

                <!-- Debug Info Section -->
                <section class="section-card" aria-labelledby="debug-heading">
                    <div class="section-header">
                        <h3 id="debug-heading" class="text-lg font-semibold flex items-center gap-2">
                            <i class="ph ph-bug text-slate-500" aria-hidden="true"></i>
                            Debug Information
                        </h3>
                        <div class="flex items-center gap-2">
                            <button id="copyDebugBtn" class="btn-icon-sm" title="Copy debug info"
                                aria-label="Copy debug information to clipboard">
                                <i class="ph ph-copy"></i>
                            </button>
                            <button id="debugToggle" class="collapse-btn" aria-label="Toggle Debug Information"
                                aria-expanded="false" aria-controls="debugContent">
                                <i id="debugCollapseIcon" class="ph ph-caret-down collapse-icon" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                    <div id="debugContent" class="collapsible-content p-6 hidden" role="region">
                        <pre id="debugInfo"
                            class="debug-output text-xs bg-slate-900 text-slate-100 p-4 rounded-lg overflow-x-auto">No debug information available</pre>
                    </div>
                </section>
            </section>

            <!-- Tool 2: Smart Extractor -->
            <section id="tool2-content" class="tool-section hidden space-y-6">
                <header class="section-header-inline mb-6 flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">Smart Extractor</h2>
                        <p class="text-sm text-slate-500 mt-1">Extract and process data from Excel files</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <span id="record-count-badge"
                            class="hidden bg-indigo-100 text-indigo-700 py-1 px-3 rounded-full text-xs font-semibold">0
                            Records</span>
                        <div class="text-right">
                            <p class="text-xs text-slate-500 uppercase tracking-wide">Total Amount</p>
                            <p id="total-display" class="text-xl font-bold text-slate-800">0,00 €</p>
                        </div>
                    </div>
                </header>

                <!-- Controls Bar -->
                <div
                    class="flex flex-wrap items-center justify-between gap-4 p-4 bg-white rounded-xl border border-slate-200 shadow-sm">
                    <div class="flex items-center gap-3 flex-1 min-w-[300px]">
                        <div class="relative flex-1">
                            <i
                                class="ph ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                            <input type="text" id="filterInput"
                                class="w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"
                                placeholder="Search by Order No, Location, Name...">
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="btnCopyTable2" disabled
                            class="btn btn-secondary disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="ph ph-copy text-lg"></i>
                            <span class="hidden sm:inline">Copy Table</span>
                        </button>
                        <button id="btn-export" disabled
                            class="btn btn-secondary disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="ph ph-download-simple text-lg"></i>
                            Export XLSX
                        </button>
                        <button id="btnClear" class="btn btn-danger">
                            <i class="ph ph-trash text-lg"></i>
                        </button>
                    </div>
                </div>

                <!-- Main Data Table -->
                <div
                    class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col h-[600px]">
                    <div class="overflow-auto custom-scrollbar flex-1">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-slate-50 sticky top-0 z-10 shadow-sm">
                                <tr>
                                    <th
                                        class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider whitespace-nowrap">
                                        File</th>
                                    <th class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider cursor-pointer hover:bg-slate-100 transition-colors group select-none whitespace-nowrap"
                                        id="header-auftrag">
                                        <div class="flex items-center gap-1">
                                            Auftrag Nr.
                                            <i data-lucide="chevrons-up-down"
                                                class="w-3 h-3 text-slate-400 opacity-0 group-hover:opacity-50 transition-opacity sort-icon"
                                                id="sort-auftragsNr"></i>
                                        </div>
                                    </th>
                                    <th class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider cursor-pointer hover:bg-slate-100 transition-colors group select-none whitespace-nowrap"
                                        id="header-anlage">
                                        <div class="flex items-center gap-1">
                                            Anlage
                                            <i data-lucide="chevrons-up-down"
                                                class="w-3 h-3 text-slate-400 opacity-0 group-hover:opacity-50 transition-opacity sort-icon"
                                                id="sort-anlage"></i>
                                        </div>
                                    </th>
                                    <th
                                        class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider whitespace-nowrap">
                                        Einsatzort</th>
                                    <th class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider cursor-pointer hover:bg-slate-100 transition-colors group select-none whitespace-nowrap"
                                        id="header-datum">
                                        <div class="flex items-center gap-1">
                                            Datum
                                            <i data-lucide="chevrons-up-down"
                                                class="w-3 h-3 text-slate-400 opacity-0 group-hover:opacity-50 transition-opacity sort-icon"
                                                id="sort-datum"></i>
                                        </div>
                                    </th>
                                    <th
                                        class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider text-right whitespace-nowrap">
                                        Std.</th>
                                    <th class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider text-right cursor-pointer hover:bg-slate-100 transition-colors group select-none whitespace-nowrap"
                                        id="header-summe">
                                        <div class="flex items-center justify-end gap-1">
                                            Summe
                                            <i data-lucide="chevrons-up-down"
                                                class="w-3 h-3 text-slate-400 opacity-0 group-hover:opacity-50 transition-opacity sort-icon"
                                                id="sort-sumRaw"></i>
                                        </div>
                                    </th>
                                    <th
                                        class="px-6 py-3 border-b border-slate-200 text-xs font-semibold text-slate-500 uppercase tracking-wider whitespace-nowrap">
                                        Bemerkung</th>
                                </tr>
                            </thead>
                            <tbody id="table-body" class="divide-y divide-slate-100">
                                <!-- Empty State -->
                                <tr id="empty-state" class="group">
                                    <td colspan="8" class="px-6 py-12 text-center text-slate-400 bg-white">
                                        <div class="flex flex-col items-center justify-center gap-3">
                                            <div
                                                class="w-16 h-16 rounded-full bg-slate-50 flex items-center justify-center mb-2 group-hover:scale-110 transition-transform duration-300">
                                                <i class="ph ph-file-dashed text-3xl text-slate-300"></i>
                                            </div>
                                            <p class="text-base font-medium text-slate-600 empty-state-title">No data
                                                extracted yet</p>
                                            <p class="text-sm text-slate-400 max-w-md mx-auto">Upload Excel files with
                                                "Protokoll" or "Abrechnung" in the filename to automatically extract
                                                data.</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Footer Info -->
                    <div
                        class="bg-slate-50 px-6 py-3 border-t border-slate-200 text-xs text-slate-500 flex justify-between items-center">
                        <span>Showing <strong id="count-display" class="text-slate-700">0</strong> records</span>
                        <div class="flex gap-4">
                            <span class="flex items-center gap-1"><span
                                    class="w-2 h-2 rounded-full bg-orange-100 border border-orange-200"></span> Has
                                Remarks</span>
                            <span class="flex items-center gap-1"><span
                                    class="w-2 h-2 rounded-full bg-white border border-slate-200"></span>
                                Standard</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tool 3: Row Manager -->
            <section id="tool3-content" class="tool-section hidden space-y-6">
                <header class="section-header-inline mb-6 flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">Row Manager</h2>
                        <p class="text-sm text-slate-500 mt-1">Manage and organize rows in Excel files</p>
                    </div>
                </header>

                <!-- Controls Bar -->
                <div
                    class="flex flex-wrap items-center justify-between gap-4 p-4 bg-white rounded-xl border border-slate-200 shadow-sm">
                    <div class="flex items-center gap-2">
                        <button id="btnCopyTable3" disabled
                            class="btn btn-secondary disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="ph ph-copy text-lg"></i>
                            Copy Selected Rows
                        </button>
                    </div>
                    <div class="flex items-center gap-3">
                        <span id="rm-status"
                            class="text-sm font-medium text-slate-600 bg-slate-100 px-3 py-1.5 rounded-lg border border-slate-200">
                            0 Rows
                        </span>
                    </div>
                </div>

                <!-- Main Row Table -->
                <div
                    class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col h-[600px]">
                    <div class="overflow-auto custom-scrollbar flex-1 relative">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-slate-50 sticky top-0 z-10 shadow-sm" id="rm-thead">
                                <tr id="rm-thead-tr">
                                    <!-- Headers injected by JS -->
                                    <th class="px-6 py-4 text-center text-slate-400 italic font-normal">Upload a file to
                                        see columns</th>
                                </tr>
                            </thead>
                            <tbody id="rm-tbody" class="divide-y divide-slate-100">
                                <!-- Rows injected by JS -->
                                <tr class="group">
                                    <td colspan="10" class="px-6 py-12 text-center text-slate-400 bg-white">
                                        <div class="flex flex-col items-center justify-center gap-3">
                                            <div
                                                class="w-16 h-16 rounded-full bg-slate-50 flex items-center justify-center mb-2 group-hover:scale-110 transition-transform duration-300">
                                                <i class="ph ph-rows text-3xl text-slate-300"></i>
                                            </div>
                                            <p class="text-base font-medium text-slate-600">No rows data</p>
                                            <p class="text-sm text-slate-400 max-w-md mx-auto">Upload an Excel file to
                                                view and manage individual rows.</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals (Settings, Help) -->
    <div id="settingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center">
        <div class="bg-white rounded-lg p-6 max-w-md w-full">
            <h2 class="text-xl font-bold mb-4">Settings</h2>
            <p class="text-slate-600 mb-4">Settings panel content</p>
            <button id="closeSettingsModal" class="btn btn-primary">Close</button>
        </div>
    </div>

    <div id="helpPanel" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center">
        <div class="bg-white rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-auto">
            <h2 class="text-xl font-bold mb-4">Help & Documentation</h2>
            <p class="text-slate-600 mb-4">Help content will be displayed here</p>
            <button id="closeHelpPanel" class="btn btn-primary">Close</button>
        </div>
    </div>

    <!-- Main Application Script -->
    <script type="module" src="src/main.js"></script>
</body>

</html>